unit Controller.Customer;

interface

uses
  MVCFramework,
  MVCFramework.Commons,
  MVCFramework.Serializer.Commons,
  System.Generics.Collections;

type
  [MVCNameCase(ncCamelCase)]
  TApiTcc = class
  Private
    FPrompt: string;
    FComplemento: string;
    FPergunta: string;
    [MVCSerializeAsString]
    FURLBase: string;
    FKey: string;
  Public
    property Prompt: string read FPrompt write FPrompt;
    property Complemento: string read FComplemento write FComplemento;
    property Pergunta: string read FPergunta write FPergunta;
    property URLBase: string read FURLBase write FURLBase;
    property Key: string read FKey write FKey;
  end;

  [MVCPath('/api')]
  TCustomer = class(TMVCController)
  public
    //
  protected
    procedure OnBeforeAction(Context: TWebContext; const AActionName: string; var Handled: Boolean); override;
    procedure OnAfterAction(Context: TWebContext; const AActionName: string); override;

  public
    [MVCPath('/perguntar')]
    [MVCHTTPMethod([httpPOST])]
    procedure CreateApiTcc([MVCFromBody] ApiTcc: TApiTcc);
  end;

implementation

uses
  System.SysUtils,
  MVCFramework.Logger,
  System.StrUtils,
  JsonDataObjects,
  System.JSON;

procedure TCustomer.OnAfterAction(Context: TWebContext; const AActionName: string);
begin
  inherited;
end;

procedure TCustomer.OnBeforeAction(Context: TWebContext; const AActionName: string; var Handled: Boolean);
begin
  inherited;
end;

procedure TCustomer.CreateApiTcc([MVCFromBody] ApiTcc: TApiTcc);
var
  Response: TJSONObject;
begin
  Response := TJSONObject.Create;

  Response.AddPair('status', 'sucesso');
  Response.AddPair('mensagem', 'Recebido com sucesso!');
  Response.AddPair('prompt', ApiTcc.Prompt);
  Response.AddPair('complemento', ApiTcc.Complemento);
  Response.AddPair('pergunta', ApiTcc.Pergunta);
  Response.AddPair('URLBase', ApiTcc.URLBase);
  Response.AddPair('key', ApiTcc.Key);

  Render(Response);
end;

end.
